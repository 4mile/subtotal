{"version":3,"sources":["subtotal.coffee"],"names":[],"mappings":"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","file":"subtotal.js","sourceRoot":"/source/","sourcesContent":["callWithJQuery = (pivotModule) ->\r\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\r\n        pivotModule require(\"jquery\")\r\n    else if typeof define is \"function\" and define.amd # AMD\r\n        define [\"jquery\"], pivotModule\r\n    # Plain browser env\r\n    else\r\n        pivotModule jQuery\r\n\r\ncallWithJQuery ($) ->\r\n\r\n    class SubtotalPivotData extends $.pivotUtilities.PivotData\r\n        constructor: (input, opts) ->\r\n            super(input, opts)\r\n\r\n        processKey = (record, totals, keys, attrs, f) ->\r\n            key = []\r\n            addKey = false\r\n            for attr in attrs\r\n                key.push record[attr] ? \"null\"\r\n                flatKey = key.join(String.fromCharCode(0))\r\n                if not totals[flatKey]\r\n                    totals[flatKey] = f(key.slice())\r\n                    addKey = true\r\n                totals[flatKey].push record\r\n            if addKey\r\n                keys.push key\r\n            return key\r\n\r\n        processRecord: (record) -> #this code is called in a tight loop\r\n            rowKey = []\r\n            colKey = []\r\n\r\n            @allTotal.push record\r\n            rowKey = processKey record, @rowTotals, @rowKeys, @rowAttrs, (key) =>\r\n                    return @aggregator(this, key, [])\r\n            colKey = processKey record, @colTotals, @colKeys, @colAttrs, (key) =>\r\n                    return @aggregator(this, [], key)\r\n            m = rowKey.length-1\r\n            n = colKey.length-1\r\n            if m < 0 or n < 0\r\n                return\r\n            for i in [0..m]\r\n                fRowKey = rowKey.slice(0, i+1)\r\n                flatRowKey = fRowKey.join(String.fromCharCode(0))\r\n                if not @tree[flatRowKey]\r\n                    @tree[flatRowKey] = {}\r\n                for j in [0..n]\r\n                    fColKey = colKey.slice(0, j+1)\r\n                    flatColKey = fColKey.join(String.fromCharCode(0))\r\n                    if not @tree[flatRowKey][flatColKey]\r\n                        @tree[flatRowKey][flatColKey] = @aggregator(this, fRowKey, fColKey)\r\n                    @tree[flatRowKey][flatColKey].push record\r\n\r\n\r\n    $.pivotUtilities.SubtotalPivotData = SubtotalPivotData\r\n\r\n    SubtotalRenderer = (pivotData, opts) ->\r\n        defaults =\r\n            table: clickCallback: null\r\n            localeStrings: totals: \"Totals\"\r\n\r\n        opts = $.extend(true, {}, defaults, opts)\r\n\r\n        arrowCollapsed = opts.arrowCollapsed ?= \"\\u25B6\"\r\n        arrowExpanded = opts.arrowExpanded ?= \"\\u25E2\"\r\n        classExpanded = \"expanded\" \r\n        classCollapsed = \"collapsed\"\r\n        colAttrs = pivotData.colAttrs\r\n        rowAttrs = pivotData.rowAttrs\r\n        rowKeys = pivotData.getRowKeys()\r\n        colKeys = pivotData.getColKeys()\r\n        tree = pivotData.tree\r\n        rowTotals = pivotData.rowTotals\r\n        colTotals = pivotData.colTotals\r\n        allTotal = pivotData.allTotal\r\n\r\n        # Based on http://stackoverflow.com/questions/195951/change-an-elements-class-with-javascript -- Begin\r\n        hasClass = (element, className) ->\r\n            regExp = new RegExp(\"(?:^|\\\\s)\" + className + \"(?!\\\\S)\", \"g\")\r\n            element.className.match(regExp)\r\n\r\n        removeClass = (element, className) ->\r\n            regExp = new RegExp(\"(?:^|\\\\s)\" + className + \"(?!\\\\S)\", \"g\")\r\n            element.className = element.className.replace(regExp, '')\r\n\r\n        addClass = (element, className) ->\r\n            if (!hasClass(element, className)) then element.className += (\" \" + className)\r\n\r\n        replaceClass = (element, replaceClassName, byClassName) ->\r\n            removeClass element, replaceClassName\r\n            addClass element, byClassName \r\n        # Based on http://stackoverflow.com/questions/195951/change-an-elements-class-with-javascript -- End \r\n\r\n        getTableEventHandlers = (value, rowValues, colValues) ->\r\n            if opts.table.eventHandlers?\r\n                tableEventHandlers = {}\r\n                for own tableEvent, tableEventHandler of opts.table.eventHandlers\r\n                    filters = {}\r\n                    filters[attr] = colValues[i] for own i, attr of colAttrs when colValues[i]?\r\n                    filters[attr] = rowValues[i] for own i, attr of rowAttrs when rowValues[i]?\r\n                    tableEventHandlers[tableEvent] = (e) -> tableEventHandler(e, value, filters, pivotData)\r\n                return tableEventHandlers\r\n\r\n        createCell = (cellType, className, textContent, attributes, eventHandlers) ->\r\n            th = document.createElement(cellType)\r\n            if className then th.className = className\r\n            if textContent isnt null and textContent isnt undefined then th.textContent = textContent\r\n            if attributes then th.setAttribute(attr, val) for own attr, val of attributes\r\n            if eventHandlers\r\n               for own event, handler of eventHandlers\r\n                   th.addEventListener(event, handler)\r\n            return th\r\n\r\n        processKeys = (keysArr, className) ->\r\n            headers = []\r\n            lastRow = keysArr.length - 1\r\n            lastCol = keysArr[0].length - 1\r\n            rMark = []\r\n            th = createCell(\"th\", className, keysArr[0][0])\r\n            key = []\r\n            key.push(keysArr[0][0])\r\n            nodePos = 0\r\n            node = {\"node\": nodePos, \"row\": 0, \"col\": 0, \"th\": th, \"parent\": null, \"children\": [], \"descendants\": lastCol, \"leaves\": 1, \"key\": key, \"flatKey\": key.join(String.fromCharCode(0))}\r\n            headers.push(node)\r\n            rMark[0] = node\r\n            c = 1\r\n            while c <= lastCol\r\n                th = createCell(\"th\", className, keysArr[0][c])\r\n                key = key.slice()\r\n                key.push(keysArr[0][c])\r\n                ++nodePos\r\n                node =  {\"node\": nodePos, \"row\": 0, \"col\": c, \"th\": th, \"parent\": rMark[c-1], \"children\": [], \"descendants\": lastCol-c, \"leaves\": 1, \"key\": key, \"flatKey\": key.join(String.fromCharCode(0))}\r\n                rMark[c] = node\r\n                rMark[c-1].children.push(node)\r\n                ++c\r\n            rMark[lastCol].leaves = 0\r\n            r = 1\r\n            while r <= lastRow\r\n                repeats = true\r\n                c = 0\r\n                key = []\r\n                key.push(keysArr[r][0])\r\n                while c <= lastCol\r\n                    if c > 0\r\n                        key = key.slice()\r\n                        key.push(keysArr[r][c])\r\n                    if ((keysArr[r][c] is keysArr[rMark[c].row][c]) and (c isnt lastCol)  and (repeats))\r\n                        repeats = true\r\n                        ++c\r\n                        continue\r\n                    th = createCell(\"th\", className, keysArr[r][c])\r\n                    ++nodePos\r\n                    node = {\"node\": nodePos, \"row\": r, \"col\": c, \"th\": th, \"parent\": null, \"children\": [], \"descendants\": 0, \"leaves\": 1, \"key\": key, \"flatKey\": key.join(String.fromCharCode(0))}\r\n                    if c is 0\r\n                        headers.push node\r\n                    else\r\n                        node.parent = rMark[c-1]\r\n                        rMark[c-1].children.push node\r\n                        x = 0\r\n                        while x <= c-1\r\n                            rMark[x].descendants = rMark[x].descendants + 1\r\n                            ++x\r\n                    rMark[c] = node\r\n                    repeats = false\r\n                    ++c\r\n                c = 0\r\n                while c <= lastCol\r\n                    rMark[c].leaves = rMark[c].leaves + 1\r\n                    ++c\r\n                rMark[lastCol].leaves = 0\r\n                ++r\r\n            return headers\r\n\r\n        buildColHeaderHeader = (thead, colHeaderHeaders, rowAttrs, colAttrs, tr, col) ->\r\n            colAttr = colAttrs[col]\r\n            # th = createCell(\"th\", \"pvtAxisLabel\", colAttr)\r\n            textContent = colAttr\r\n            className = \"pvtAxisLabel\"\r\n            if col < colAttrs.length-1\r\n                className += \" expanded\"\r\n                textContent = \" \" + arrowExpanded + \" \" + colAttr\r\n            th = createCell(\"th\", className, textContent)\r\n            th.setAttribute(\"data-colAttr\", colAttr)\r\n            tr.appendChild th\r\n            colHeaderHeaders.push({\"tr\": tr, \"th\": th, \"clickStatus\": classExpanded, \"expandedCount\": 0, \"nHeaders\": 0})\r\n            thead.appendChild tr\r\n\r\n        buildColHeaderHeaders = (thead, colHeaderHeaders, rowAttrs, colAttrs) ->\r\n            tr = document.createElement(\"tr\")\r\n            if rowAttrs.length != 0\r\n                tr.appendChild createCell(\"th\", null, null, {\"colspan\": rowAttrs.length, \"rowspan\": colAttrs.length});\r\n            buildColHeaderHeader thead, colHeaderHeaders, rowAttrs, colAttrs, tr, 0\r\n            for c in [1..colAttrs.length] when c < colAttrs.length\r\n                tr = document.createElement(\"tr\")\r\n                buildColHeaderHeader thead, colHeaderHeaders, rowAttrs, colAttrs, tr, c\r\n\r\n        buildColHeaderHeadersClickEvents = (colHeaderHeaders, colHeaderCols, colAttrs) ->\r\n            for i in [0..colAttrs.length-1] when i < colAttrs.length-1\r\n                th = colHeaderHeaders[i].th\r\n                colAttr = colAttrs[i]\r\n                th.onclick = (event) ->\r\n                    event = event || window.event\r\n                    toggleColHeaderHeader colHeaderHeaders, colHeaderCols, colAttrs, event.target.getAttribute(\"data-colAttr\")\r\n\r\n        buildColHeaders = (colHeaderHeaders, colHeaderCols, colHeader, rowAttrs, colAttrs) ->\r\n            # DF Recurse\r\n            for h in colHeader.children\r\n                buildColHeaders(colHeaderHeaders, colHeaderCols, h, rowAttrs, colAttrs)\r\n            # Process\r\n            hh = colHeaderHeaders[colHeader.col]\r\n            ++hh.expandedCount\r\n            ++hh.nHeaders\r\n            tr = hh.tr\r\n            th = colHeader.th\r\n            th.setAttribute(\"data-colHeader\", th.textContent)\r\n            if colHeader.col == colAttrs.length-1 and rowAttrs.length != 0\r\n                th.setAttribute(\"rowspan\", 2)\r\n            if colHeader.children.length !=0\r\n                th.setAttribute(\"colspan\", colHeader.descendants+1)\r\n            th.setAttribute(\"data-node\", colHeaderCols.length)\r\n            tr.appendChild(th)\r\n            if colHeader.children.length !=0\r\n                addClass th, classExpanded\r\n                th.textContent = \" \" + arrowExpanded + \" \" + th.textContent\r\n                th.onclick = (event) ->\r\n                    event = event || window.event\r\n                    toggleCol(colHeaderHeaders, colHeaderCols, parseInt(event.target.getAttribute(\"data-node\")))\r\n                rowspan = colAttrs.length-(colHeader.col+1) + if rowAttrs.length != 0 then 1 else 0\r\n                style = \"pvtColLabel col\" + colHeader.row\r\n                th = createCell(\"th\", style, '', {\"rowspan\": rowspan})\r\n                colHeader.children[0].tr.appendChild(th)\r\n                colHeader.sTh = th\r\n            colHeader.clickStatus = classExpanded\r\n            colHeader.tr = tr\r\n            colHeaderCols.push(colHeader)\r\n\r\n        buildRowHeaderHeaders = (thead, rowHeaderHeaders, rowAttrs, colAttrs) ->\r\n            tr = document.createElement(\"tr\")\r\n            rowHeaderHeaders.hh = []\r\n            for own i, rowAttr of rowAttrs\r\n                textContent = rowAttr\r\n                className = \"pvtAxisLabel\"\r\n                if i < rowAttrs.length-1\r\n                    className += \" expanded\"\r\n                    textContent = \" \" + arrowExpanded + \" \" + rowAttr\r\n                th = createCell(\"th\", className, textContent)\r\n                th.setAttribute(\"data-rowAttr\", rowAttr)\r\n                tr.appendChild th\r\n                rowHeaderHeaders.hh.push({\"th\": th, \"clickStatus\": classExpanded, \"expandedCount\": 0, \"nHeaders\": 0})\r\n            if colAttrs.length != 0\r\n                th = createCell(\"th\")\r\n                tr.appendChild th\r\n            thead.appendChild tr\r\n            rowHeaderHeaders.tr = tr\r\n\r\n        buildRowHeaderHeadersClickEvents = (rowHeaderHeaders, rowHeaderRows, rowAttrs) ->\r\n            for i in [0..rowAttrs.length-1] when i < rowAttrs.length-1\r\n                th = rowHeaderHeaders.hh[i]\r\n                rowAttr = rowAttrs[i]\r\n                th.th.onclick = (event) ->\r\n                    event = event || window.event\r\n                    toggleRowHeaderHeader rowHeaderHeaders, rowHeaderRows, rowAttrs, event.target.getAttribute(\"data-rowAttr\")\r\n\r\n        buildRowTotalsHeader = (tr, rowAttrs, colAttrs) ->\r\n            rowspan = 1\r\n            if colAttrs.length != 0\r\n                rowspan = colAttrs.length + (if rowAttrs.length ==0 then 0 else 1)\r\n            th = createCell(\"th\", \"pvtTotalLabel\", opts.localeStrings.totals, {\"rowspan\": rowspan})\r\n            tr.appendChild th\r\n\r\n        buildRowHeaders = (tbody, rowHeaderHeaders, rowHeaderRows, rowHeader, rowAttrs, colAttrs) ->\r\n            hh = rowHeaderHeaders.hh[rowHeader.col]\r\n            ++hh.expandedCount\r\n            ++hh.nHeaders\r\n            tr = document.createElement(\"tr\")\r\n            th = rowHeader.th\r\n            th.setAttribute(\"rowspan\", rowHeader.descendants+1)\r\n            th.setAttribute(\"data-rowHeader\", th.textContent)\r\n            if rowHeader.col == rowAttrs.length-1 and colAttrs.length != 0\r\n                th.setAttribute(\"colspan\", 2)\r\n            th.setAttribute(\"data-node\", rowHeaderRows.length)\r\n            tr.appendChild(th)\r\n            if rowHeader.children.length != 0\r\n                addClass th, classExpanded\r\n                th.textContent = \" \" + arrowExpanded + \" \" + th.textContent\r\n                th.onclick = (event) ->\r\n                    event = event || window.event\r\n                    toggleRow(rowHeaderHeaders, rowHeaderRows, parseInt(event.target.getAttribute(\"data-node\")))\r\n                colspan = rowAttrs.length-(rowHeader.col+1) + if colAttrs.length != 0 then 1 else 0\r\n                th = createCell(\"th\", \"pvtRowLabel pvtRowSubtotal\", '', {\"colspan\": colspan})\r\n                tr.appendChild(th)\r\n            rowHeader.clickStatus = classExpanded\r\n            rowHeader.tr = tr\r\n            rowHeaderRows.push(rowHeader)\r\n            tbody.appendChild(tr)\r\n            for h in rowHeader.children\r\n                buildRowHeaders(tbody, rowHeaderHeaders, rowHeaderRows, h, rowAttrs, colAttrs)\r\n\r\n        buildValues = (rowHeaderRows, colHeaderCols) ->\r\n            for rowHeader in rowHeaderRows\r\n                tr = rowHeader.tr\r\n                flatRowKey = rowHeader.flatKey\r\n                for colHeader in colHeaderCols\r\n                    flatColKey = colHeader.flatKey\r\n                    aggregator = tree[flatRowKey][flatColKey] ? {value: (-> null), format: -> \"\"}\r\n                    val = aggregator.value()\r\n                    style = \"pvtVal\"\r\n                    style = if (colHeader.children.length != 0) then  style +  \" pvtColSubtotal\" else style\r\n                    style = if (rowHeader.children.length != 0) then  style +  \" pvtRowSubtotal\" else style\r\n                    style = style + \" row\"+rowHeader.row+\" col\"+colHeader.row+\" rowcol\"+rowHeader.col+\" colcol\"+colHeader.col\r\n                    td = createCell(\"td\", style, aggregator.format(val), {\"data-value\": val}, getTableEventHandlers(val, rowHeader.key, colHeader.key))\r\n                    tr.appendChild td\r\n                # buildRowTotal\r\n                totalAggregator = rowTotals[flatRowKey]\r\n                val = totalAggregator.value()\r\n                style = \"pvtTotal rowTotal\"\r\n                style = if (rowHeader.children.length != 0) then  style +  \" pvtRowSubtotal\" else style\r\n                style = style + \" row\"+rowHeader.row+\" rowcol\"+rowHeader.col\r\n                td = createCell(\"td\", style, totalAggregator.format(val), {\"data-value\": val, \"data-row\": \"row\"+rowHeader.row, \"data-col\": \"col\"+rowHeader.col}, getTableEventHandlers(val, rowHeader.key, []))\r\n                tr.appendChild td\r\n\r\n        buildColTotalsHeader = (rowAttrs, colAttrs) ->\r\n            tr = document.createElement(\"tr\")\r\n            colspan = rowAttrs.length + (if colAttrs.length == 0 then 0 else 1)\r\n            th = createCell(\"th\", \"pvtTotalLabel\", opts.localeStrings.totals, {\"colspan\": colspan})\r\n            tr.appendChild(th)\r\n            return tr\r\n\r\n        buildColTotals = (tr, colHeaderCols) ->\r\n            for h in colHeaderCols\r\n                totalAggregator = colTotals[h.flatKey]\r\n                val = totalAggregator.value()\r\n                style = \"pvtVal pvtTotal colTotal\"\r\n                style = if h.children.length then style + \" pvtColSubtotal\" else style\r\n                style = style + \" col\"+h.row+\" colcol\"+h.col\r\n                td = createCell(\"td\", style, totalAggregator.format(val), {\"data-value\": val, \"data-for\": \"col\"+h.col}, getTableEventHandlers(val, [], h.key))\r\n                tr.appendChild td\r\n\r\n        buildGrandTotal = (result, tr) ->\r\n            totalAggregator = allTotal\r\n            val = totalAggregator.value()\r\n            td = createCell(\"td\", \"pvtGrandTotal\", totalAggregator.format(val), {\"data-value\": val}, getTableEventHandlers(val, [], []))\r\n            tr.appendChild td\r\n            result.appendChild tr\r\n\r\n        setColVisibility = (visibility, h) ->\r\n            h.th.style.display = visibility\r\n            if h.children.length\r\n                $(h.th).closest('table.pvtTable').find('tbody tr td.pvtColSubtotal.col' + h.row + '.colcol' + h.col).css('display', visibility)\r\n            else\r\n                $(h.th).closest('table.pvtTable').find('tbody tr td.pvtVal.col' + h.row).not('.pvtColSubtotal').css('display', visibility)\r\n            if h.sTh\r\n                h.sTh.style.display = visibility\r\n\r\n        collapseCol = (colHeaderHeaders, colHeaderCols, c) ->\r\n            if not colHeaderCols[c]\r\n                return\r\n            h = colHeaderCols[c]\r\n            if h.clickStatus is classCollapsed\r\n                return\r\n            colspan = 0\r\n            for i in [1..h.descendants] when h.descendants != 0\r\n                d = colHeaderCols[c-i]\r\n                if d.th.style.display isnt \"none\"\r\n                    ++colspan\r\n                    setColVisibility \"none\", d\r\n            p = h.parent\r\n            while p isnt null\r\n                p.th.setAttribute(\"colspan\", parseInt(p.th.getAttribute(\"colspan\"))-colspan)\r\n                p = p.parent\r\n            if h.descendants != 0\r\n                replaceClass h.th, classExpanded, classCollapsed\r\n                h.th.textContent = \" \" + arrowCollapsed + \" \" + h.th.getAttribute(\"data-colHeader\")\r\n            h.clickStatus = classCollapsed\r\n            h.th.setAttribute(\"colspan\", 1)\r\n            h.th.style.display = \"\"\r\n            colHeaderHeader = colHeaderHeaders[h.col]\r\n            colHeaderHeader.expandedCount--\r\n            if colHeaderHeader.expandedCount == 0\r\n                for i in [h.col..colHeaderHeaders.length-2]\r\n                    colHeaderHeader = colHeaderHeaders[i]\r\n                    replaceClass colHeaderHeader.th, classExpanded, classCollapsed\r\n                    colHeaderHeader.th.textContent = \" \" + arrowCollapsed + \" \" + colHeaderHeader.th.getAttribute(\"data-colAttr\")\r\n                    colHeaderHeader.clickStatus = classCollapsed\r\n\r\n        expandChildCol = (ch) ->\r\n            if ch.th.style.display is \"none\"\r\n                setColVisibility \"\", ch\r\n            if ch.clickStatus isnt classCollapsed\r\n                for gch in ch.children\r\n                    expandChildCol gch\r\n\r\n        expandCol = (colHeaderHeaders, colHeaderCols, c) ->\r\n            if not colHeaderCols[c]\r\n                return\r\n            h = colHeaderCols[c]\r\n            if h.clickStatus is classExpanded\r\n                return\r\n            colspan = 0\r\n            for ch in h.children\r\n                colspan = colspan + ch.th.colSpan\r\n                if ch.th.style.display is \"none\"\r\n                    setColVisibility \"\", ch\r\n                expandChildCol ch\r\n            if h.descendants != 0\r\n                replaceClass h.th, classCollapsed, classExpanded\r\n                h.th.textContent = \" \" + arrowExpanded + \" \" + h.th.getAttribute(\"data-colHeader\")\r\n            h.th.setAttribute(\"colspan\", colspan+1)\r\n            h.clickStatus = classExpanded\r\n            h.th.style.display = \"\"\r\n            if h.sTh\r\n                h.sTh.style.display = \"\"\r\n            p = h.parent\r\n            while p isnt null\r\n                p.th.setAttribute(\"colspan\", (colspan + parseInt(p.th.getAttribute(\"colspan\"))))\r\n                p = p.parent\r\n            hh = colHeaderHeaders[h.col]\r\n            ++hh.expandedCount\r\n            if hh.expandedCount == hh.nHeaders\r\n                replaceClass hh.th, classCollapsed, classExpanded\r\n                hh.th.textContent = \" \" + arrowExpanded + \" \" + hh.th.getAttribute(\"data-colAttr\")\r\n                hh.clickStatus = classExpanded\r\n\r\n        collapseRow = (rowHeaderHeaders, rowHeaderRows, r) ->\r\n            if not rowHeaderRows[r]\r\n                return\r\n            h = rowHeaderRows[r]\r\n            if h.clickStatus is classCollapsed\r\n                return\r\n            rowspan = 0\r\n            for i in [1..h.descendants] when h.descendants != 0\r\n                d = rowHeaderRows[r+i]\r\n                if d.tr.style.display isnt \"none\"\r\n                    ++rowspan\r\n                    d.tr.style.display = \"none\"\r\n            p = h.parent\r\n            while p isnt null\r\n                p.th.setAttribute(\"rowspan\", parseInt(p.th.getAttribute(\"rowspan\"))-rowspan)\r\n                p = p.parent\r\n            if h.descendants != 0\r\n                replaceClass h.th, classExpanded, classCollapsed\r\n                h.th.textContent = \" \" + arrowCollapsed + \" \" + h.th.getAttribute(\"data-rowHeader\")\r\n            h.clickStatus = classCollapsed\r\n            h.th.setAttribute(\"rowspan\", 1)\r\n            h.tr.style.display = \"\"\r\n            rowHeaderHeader = rowHeaderHeaders.hh[h.col]\r\n            rowHeaderHeader.expandedCount--\r\n            if rowHeaderHeader.expandedCount == 0\r\n                for j in [h.col..rowHeaderHeaders.hh.length-2]\r\n                    rowHeaderHeader = rowHeaderHeaders.hh[j]\r\n                    replaceClass rowHeaderHeader.th, classExpanded, classCollapsed\r\n                    rowHeaderHeader.th.textContent = \" \" + arrowCollapsed + \" \" + rowHeaderHeader.th.getAttribute(\"data-rowAttr\")\r\n                    rowHeaderHeader.clickStatus = classCollapsed\r\n\r\n        expandChildRow = (ch) ->\r\n            if ch.tr.style.display is \"none\"\r\n                ch.tr.style.display = \"\"\r\n            if ch.clickStatus isnt classCollapsed\r\n                for gch in ch.children\r\n                    expandChildRow gch\r\n\r\n        expandRow = (rowHeaderHeaders, rowHeaderRows, r) ->\r\n            if not rowHeaderRows[r]\r\n                return\r\n            h = rowHeaderRows[r]\r\n            if h.clickStatus is classExpanded\r\n                return\r\n            rowspan = 0\r\n            for ch in h.children\r\n                rowspan = rowspan + ch.th.rowSpan\r\n                if ch.tr.style.display is \"none\"\r\n                    ch.tr.style.display = \"\"\r\n                expandChildRow ch\r\n            if h.descendants != 0\r\n                replaceClass h.th, classCollapsed, classExpanded\r\n                h.th.textContent = \" \" + arrowExpanded + \" \" + h.th.getAttribute(\"data-rowHeader\")\r\n            h.th.setAttribute(\"rowspan\", rowspan+1)\r\n            h.clickStatus = classExpanded\r\n            h.tr.style.display = \"\"\r\n            p = h.parent\r\n            while p isnt null\r\n                p.th.setAttribute(\"rowspan\", (rowspan + parseInt(p.th.getAttribute(\"rowspan\"))))\r\n                p = p.parent\r\n            hh = rowHeaderHeaders.hh[h.col]\r\n            ++hh.expandedCount\r\n            if hh.expandedCount == hh.nHeaders\r\n                replaceClass hh.th, classCollapsed, classExpanded\r\n                hh.th.textContent = \" \" + arrowExpanded + \" \" + hh.th.getAttribute(\"data-rowAttr\")\r\n                hh.clickStatus = classExpanded\r\n\r\n        toggleCol = (colHeaderHeaders, colHeaderCols, c) ->\r\n            if not colHeaderCols[c]\r\n                return\r\n            h = colHeaderCols[c]\r\n            if h.clickStatus is classCollapsed\r\n                expandCol(colHeaderHeaders, colHeaderCols, c)\r\n            else\r\n                collapseCol(colHeaderHeaders, colHeaderCols, c)\r\n            h.th.scrollIntoView\r\n\r\n        toggleRow = (rowHeaderHeaders, rowHeaderRows, r) ->\r\n            if not rowHeaderRows[r]\r\n                return\r\n            if rowHeaderRows[r].clickStatus is classCollapsed\r\n                expandRow(rowHeaderHeaders, rowHeaderRows, r)\r\n            else\r\n                collapseRow(rowHeaderHeaders, rowHeaderRows, r)\r\n\r\n        collapseColsAt = (colHeaderHeaders, colHeaderCols, colAttrs, colAttr) ->\r\n            if typeof colAttr is 'string'\r\n                idx = colAttrs.indexOf(colAttr)\r\n            else\r\n                idx = colAttr\r\n            if idx < 0 or idx == colAttrs.length-1\r\n                return\r\n            i = idx\r\n            nAttrs = colAttrs.length-1\r\n            while i < nAttrs\r\n                hh = colHeaderHeaders[i]\r\n                replaceClass hh.th, classExpanded, classCollapsed\r\n                hh.th.textContent = \" \" + arrowCollapsed + \" \" + colAttrs[i]\r\n                hh.clickStatus = classCollapsed\r\n                ++i\r\n            i = 0\r\n            nCols = colHeaderCols.length\r\n            while i < nCols\r\n                h = colHeaderCols[i]\r\n                if h.col is idx and h.clickStatus isnt classCollapsed and h.th.style.display isnt \"none\"\r\n                    collapseCol(colHeaderHeaders, colHeaderCols, parseInt(h.th.getAttribute(\"data-node\")))\r\n                ++i\r\n\r\n        expandColsAt = (colHeaderHeaders, colHeaderCols, colAttrs, colAttr) ->\r\n            if typeof colAttr is 'string'\r\n                idx = colAttrs.indexOf(colAttr)\r\n            else\r\n                idx = colAttr\r\n            if idx < 0 or idx == colAttrs.length-1\r\n                return\r\n            for i in [0..idx]\r\n                hh = colHeaderHeaders[i]\r\n                replaceClass hh.th, classCollapsed, classExpanded\r\n                hh.th.textContent = \" \" + arrowExpanded + \" \" + colAttrs[i]\r\n                hh.clickStatus = classExpanded\r\n                j = 0\r\n                nCols = colHeaderCols.length\r\n                while j < nCols\r\n                    h = colHeaderCols[j]\r\n                    if h.col == i\r\n                        expandCol(colHeaderHeaders, colHeaderCols, j)\r\n                    ++j\r\n            ++idx\r\n            while idx < colAttrs.length-1\r\n                colHeaderHeader = colHeaderHeaders[idx]\r\n                if colHeaderHeader.expandedCount == 0\r\n                    replaceClass colHeaderHeader.th, classExpanded, classCollapsed\r\n                    colHeaderHeader.th.textContent = \" \" + arrowCollapsed + \" \" + colAttrs[idx]\r\n                    colHeaderHeader.clickStatus = classCollapsed\r\n                else if colHeaderHeader.expandedCount == colHeaderHeader.nHeaders\r\n                    replaceClass colHeaderHeader.th, classCollapsed, classExpanded\r\n                    colHeaderHeader.th.textContent = \" \" + arrowExpanded + \" \" + colAttrs[idx]\r\n                    colHeaderHeader.clickStatus = classExpanded\r\n                ++idx\r\n\r\n        collapseRowsAt = (rowHeaderHeaders, rowHeaderRows, rowAttrs, rowAttr) ->\r\n            if typeof rowAttr is 'string'\r\n                idx = rowAttrs.indexOf(rowAttr)\r\n            else\r\n                idx = rowAttr\r\n            if idx < 0 or idx == rowAttrs.length-1\r\n                return\r\n            i = idx\r\n            nAttrs = rowAttrs.length-1\r\n            while i < nAttrs\r\n                h = rowHeaderHeaders.hh[i]\r\n                replaceClass h.th, classExpanded, classCollapsed\r\n                h.th.textContent = \" \" + arrowCollapsed + \" \" + rowAttrs[i]\r\n                h.clickStatus = classCollapsed\r\n                ++i\r\n            j = 0\r\n            nRows = rowHeaderRows.length\r\n            while j < nRows\r\n                h = rowHeaderRows[j]\r\n                if h.col is idx and h.clickStatus isnt classCollapsed and h.tr.style.display isnt \"none\"\r\n                    collapseRow(rowHeaderHeaders, rowHeaderRows, j)\r\n                    j = j + h.descendants + 1\r\n                else\r\n                    ++j\r\n\r\n        expandRowsAt = (rowHeaderHeaders, rowHeaderRows, rowAttrs, rowAttr) ->\r\n            if typeof rowAttr is 'string'\r\n                idx = rowAttrs.indexOf(rowAttr)\r\n            else\r\n                idx = rowAttr\r\n            if idx < 0 or idx == rowAttrs.length-1\r\n                return\r\n            for i in [0..idx]\r\n                hh = rowHeaderHeaders.hh[i]\r\n                replaceClass hh.th, classCollapsed, classExpanded\r\n                hh.th.textContent = \" \" + arrowExpanded + \" \" + rowAttrs[i]\r\n                hh.clickStatus = classExpanded\r\n                j = 0\r\n                nRows = rowHeaderRows.length\r\n                while j < nRows\r\n                    h = rowHeaderRows[j]\r\n                    if h.col == i\r\n                        expandRow(rowHeaderHeaders, rowHeaderRows, j)\r\n                        j = j + h.descendants + 1\r\n                    else\r\n                        ++j\r\n            ++idx\r\n            while idx < rowAttrs.length-1\r\n                rowHeaderHeader = rowHeaderHeaders.hh[idx]\r\n                if rowHeaderHeader.expandedCount == 0\r\n                    replaceClass rowHeaderHeader.th, classExpanded, classCollapsed\r\n                    rowHeaderHeader.th.textContent = \" \" + arrowCollapsed + \" \" + rowAttrs[idx]\r\n                    rowHeaderHeader.clickStatus = classCollapsed\r\n                else if rowHeaderHeader.expandedCount == rowHeaderHeader.nHeaders\r\n                    replaceClass rowHeaderHeader.th, classCollapsed, classExpanded\r\n                    rowHeaderHeader.th.textContent = \" \" + arrowExpanded + \" \" + rowAttrs[idx]\r\n                    rowHeaderHeader.clickStatus = classExpanded\r\n                ++idx\r\n\r\n        toggleColHeaderHeader = (colHeaderHeaders, colHeaderCols, colAttrs, colAttr) ->\r\n            idx = colAttrs.indexOf(colAttr)\r\n            h = colHeaderHeaders[idx]\r\n            if h.clickStatus is classCollapsed\r\n                expandColsAt colHeaderHeaders, colHeaderCols, colAttrs, colAttr\r\n            else\r\n                collapseColsAt colHeaderHeaders, colHeaderCols, colAttrs, colAttr\r\n\r\n\r\n        toggleRowHeaderHeader = (rowHeaderHeaders, rowHeaderRows, rowAttrs, rowAttr) ->\r\n            idx = rowAttrs.indexOf(rowAttr)\r\n            th = rowHeaderHeaders.hh[idx]\r\n            if th.clickStatus is classCollapsed\r\n                expandRowsAt rowHeaderHeaders, rowHeaderRows, rowAttrs, rowAttr\r\n            else\r\n                collapseRowsAt rowHeaderHeaders, rowHeaderRows, rowAttrs, rowAttr\r\n\r\n        main = (rowAttrs, rowKeys, colAttrs, colKeys) ->\r\n            rowHeaders = []\r\n            colHeaders = []\r\n            rowHeaderHeaders = {}\r\n            rowHeaderRows = []\r\n            colHeaderHeaders = []\r\n            colHeaderCols = []\r\n\r\n            if rowAttrs.length != 0 and rowKeys.length != 0\r\n                rowHeaders = processKeys(rowKeys, \"pvtRowLabel\")\r\n            if colAttrs.length != 0 and colKeys.length != 0\r\n                colHeaders = processKeys(colKeys, \"pvtColLabel\")\r\n            result = document.createElement(\"table\")\r\n            result.className = \"pvtTable\"\r\n            result.style.display = \"none\"\r\n            thead = document.createElement(\"thead\")\r\n            result.appendChild thead\r\n            if colAttrs.length != 0\r\n                buildColHeaderHeaders(thead, colHeaderHeaders, rowAttrs, colAttrs)\r\n                for h in colHeaders\r\n                   buildColHeaders colHeaderHeaders, colHeaderCols, h, rowAttrs, colAttrs\r\n                buildColHeaderHeadersClickEvents colHeaderHeaders, colHeaderCols, colAttrs\r\n            if rowAttrs.length != 0\r\n                buildRowHeaderHeaders(thead, rowHeaderHeaders, rowAttrs, colAttrs)\r\n                if colAttrs.length == 0\r\n                    buildRowTotalsHeader(rowHeaderHeaders.tr, rowAttrs, colAttrs)\r\n            if colAttrs.length != 0\r\n                buildRowTotalsHeader(colHeaderHeaders[0].tr, rowAttrs, colAttrs)\r\n            tbody = document.createElement(\"tbody\")\r\n            result.appendChild tbody\r\n            if rowAttrs.length != 0\r\n                for h in rowHeaders\r\n                    buildRowHeaders tbody, rowHeaderHeaders, rowHeaderRows, h, rowAttrs, colAttrs\r\n                buildRowHeaderHeadersClickEvents rowHeaderHeaders, rowHeaderRows, rowAttrs\r\n            buildValues(rowHeaderRows, colHeaderCols)\r\n            tr = buildColTotalsHeader(rowAttrs, colAttrs)\r\n            if colAttrs.length != 0\r\n                buildColTotals(tr, colHeaderCols)\r\n            buildGrandTotal(tbody, tr)\r\n            result.setAttribute(\"data-numrows\", rowKeys.length)\r\n            result.setAttribute(\"data-numcols\", colKeys.length)\r\n            if not opts.collapseRowsAt? and not opts.collapseColsAt?\r\n                result.style.display = \"\"\r\n            if opts.collapseRowsAt?\r\n                setTimeout (->\r\n                    collapseRowsAt rowHeaderHeaders, rowHeaderRows, rowAttrs, opts.collapseRowsAt\r\n                    if not opts.collapseColsAt\r\n                        result.style.display = \"\"\r\n                ), 0\r\n            if opts.collapseColsAt?\r\n                setTimeout (->\r\n                    collapseColsAt colHeaderHeaders, colHeaderCols, colAttrs, opts.collapseColsAt\r\n                    result.style.display = \"\"\r\n                ), 0\r\n            return result\r\n\r\n        return main(rowAttrs, rowKeys, colAttrs, colKeys)\r\n\r\n    $.pivotUtilities.subtotal_renderers =\r\n        \"Table With Subtotal\":  (pvtData, opts) -> SubtotalRenderer(pvtData, opts)\r\n        \"Table With Subtotal Bar Chart\":   (pvtData, opts) -> $(SubtotalRenderer(pvtData, opts)).barchart()\r\n        \"Table With Subtotal Heatmap\":   (pvtData, opts) -> $(SubtotalRenderer(pvtData, opts)).heatmap(\"heatmap\", opts)\r\n        \"Table With Subtotal Row Heatmap\":   (pvtData, opts) -> $(SubtotalRenderer(pvtData, opts)).heatmap(\"rowheatmap\", opts)\r\n        \"Table With Subtotal Col Heatmap\":  (pvtData, opts) -> $(SubtotalRenderer(pvtData, opts)).heatmap(\"colheatmap\", opts)\r\n"]}